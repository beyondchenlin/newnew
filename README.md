# Banai 视频合成工具

一个强大的AI驱动视频合成工具，支持多视频画中画效果、智能字幕分析、语音合成和自动化视频处理流水线。

## 📖 项目介绍

Banai是一个专业的视频合成工具，特别适用于：
- 📚 **教育内容制作**：自动生成英语学习视频，提取词汇、短语并生成对应音频
- 🎬 **短视频创作**：快速制作画中画效果，支持多种背景和布局
- 📱 **社交媒体内容**：批量生成视频内容，提高创作效率
- 🤖 **AI驱动处理**：结合通义千问API进行智能字幕分析和内容提取

## 🌟 主要特性

### 🎬 视频处理功能
- **多视频画中画合成**：支持主视频+侧视频的复合布局
- **智能背景处理**：高斯模糊背景或纯黑背景可选
- **动态缩放效果**：三阶段渐进式放大效果（2new目录）
- **蓝幕抠像**：专业的背景替换技术
- **水印叠加**：支持动态呼吸效果的水印

### 🤖 AI智能功能
- **字幕智能分析**：使用通义千问API分析英文字幕
- **内容自动提取**：自动提取词汇、短语、表达式
- **语音合成**：火山引擎TTS，支持多种音色
- **时间戳验证**：确保提取内容的时间准确性

### ⚡ 自动化处理
- **批量循环处理**：支持多轮自动化处理
- **智能文件管理**：自动创建目录结构和序号管理
- **完整处理流水线**：从字幕分析到最终视频输出的一体化流程
- **高性能处理**：FFmpeg深度集成，支持复杂视频特效

## 📁 目录结构

```
project/
├── assets/            # 资源目录
│   ├── pip1_videos/  # 主视频素材
│   ├── pip1_audio/   # 主视频音频素材
│   ├── pip2_videos/  # 侧视频素材
│   └── pip3_videos/  # 备用视频素材
├── outputs/          # 输出目录
├── video_synthesis/  # 核心代码目录
├── fonts/           # 字体文件
├── logs/            # 日志文件
└── subtitles/       # 字幕文件
```

## 🚀 使用方法

### 1. 环境准备
```bash
# 安装Python依赖
pip install -r requirements.txt

# 验证安装
python -c "import cv2, numpy, pandas, requests, openai, psutil, rich; print('所有依赖安装成功!')"
```

### 2. 基础使用
```bash
# 单次视频处理
python run.py 1  # 高斯模糊背景
python run.py 2  # 纯黑背景
```

### 3. 批量处理（推荐）
```bash
# 自动循环处理（默认3轮完整流程）
python app.py
```

### 4. 高级功能
```bash
# 单独运行字幕分析
python video_synthesis/examples/process_subtitle.py -v <视频名称>

# 单独运行学习视频生成
python video_synthesis/examples/create_learning_video.py

# 单独运行视频切割
python qiege.py

# 单独运行视频合成
python hecheng.py

# 单独添加水印
python jiaobiao.py
```

## 🎥 视频合成规则

- **主视频**：
  - 位置：居中靠左
  - 尺寸：原始尺寸的1/3
  - 音频：保留

- **背景**：
  - 类型：高斯模糊/纯黑
  - 来源：主视频
  - 音频：移除

- **侧视频**：
  - 位置：居中靠右
  - 尺寸：原始尺寸的1/4
  - 音频：移除
  - 数量：自动计算以匹配总时长

## � 素材准备

### 视频文件结构
```
assets/pip1_videos/
├── video001/
│   ├── video001.mp4     # 主视频文件
│   ├── video001.csv     # 文字内容文件
│   ├── video001_en.srt  # 英文字幕（AI分析用）
│   └── video001_zh.srt  # 中文字幕（可选）
└── video002/
    ├── video002.mp4
    ├── video002.csv
    └── ...

assets/pip2_videos/
├── side_video1.mp4      # 侧视频素材
├── side_video2.mp4
└── ...
```

### CSV文件格式
文字内容文件需包含以下列：
| 主标题 | 副标题 | 底部文字 |
|--------|--------|----------|
| 学英语 | 每日一句 | 坚持就是胜利 |
| 单词学习 | 词汇积累 | 每天进步一点点 |

### 字幕文件要求
- **英文字幕**：用于AI分析，提取学习内容
- **中文字幕**：用于生成双语字幕效果
- **格式支持**：SRT、ASS格式

## 🎬 处理流程

### 完整流水线（python app.py）
1. **字幕分析阶段**
   - 🤖 AI分析英文字幕，提取词汇、短语、表达式
   - 🎙️ 使用火山引擎TTS生成多音色语音
   - ✂️ 根据时间戳剪辑对应视频片段

2. **视频合成阶段**
   - 🎬 创建画中画布局（主视频+侧视频）
   - 🌫️ 生成背景效果（模糊/纯黑）
   - 📝 添加文字叠加效果

3. **后期处理阶段**
   - 🔪 智能切割成7个片段
   - 🧩 合成原片段+学习片段
   - ✨ 添加动态水印效果

### 输出结果
- **主要视频**：`outputs/{视频名称}/{序号}/最终视频.mp4`
- **学习片段**：`subtitles/{视频名称}/{序号}/clips/`
- **音频文件**：`subtitles/{视频名称}/{序号}/audio/`
- **分析结果**：`subtitles/{视频名称}/{序号}/analysis.json`

## �📝 注意事项

### 环境要求
1. **Python 3.8+** 和所有依赖包
2. **FFmpeg** 已安装或使用项目自带版本
3. **API配置** 通义千问和火山引擎TTS密钥已配置

### 素材要求
1. 确保assets目录下有足够的视频素材
2. 视频格式支持：**.mp4**
3. 所有输入视频需确保可正常读取
4. CSV文件格式正确，包含必要的文字内容

### 性能建议
1. **内存要求**：建议8GB以上内存
2. **存储空间**：确保有足够空间存储临时文件和输出
3. **网络连接**：AI分析和语音合成需要网络连接
4. **处理时间**：完整流程可能需要较长时间，建议耐心等待

## 🛠️ 技术栈

### 核心技术
- **Python 3.8+** - 主要开发语言
- **FFmpeg** - 视频处理引擎
- **OpenCV** - 计算机视觉和图像处理
- **Pillow** - 图像处理库

### AI和API
- **通义千问API** - 智能字幕分析
- **火山引擎TTS** - 语音合成服务
- **OpenAI客户端** - API调用

### 其他依赖
- **NumPy** - 数值计算
- **Pandas** - 数据处理
- **Rich** - 终端美化
- **psutil** - 系统监控

## 🎯 效果展示

### 处理前后对比
- **输入**：单个MP4视频 + 字幕文件 + CSV文字内容
- **输出**：包含画中画效果、背景处理、文字叠加、学习内容的完整视频

### 支持的效果
- 🌫️ **高斯模糊背景** - 柔和的背景虚化效果
- 📱 **画中画布局** - 主视频+侧视频的专业布局
- 📝 **多层文字叠加** - 标题、副标题、底部文字
- 🎵 **智能音频处理** - 保留主音轨，处理辅助音轨
- ✨ **动态水印** - 呼吸效果的品牌标识
- 🤖 **AI学习内容** - 自动生成的词汇学习片段

## � 配置说明

### API配置
项目中已预配置API密钥，如需更换：
- **通义千问**：编辑 `video_synthesis/core/deepseek.py` 中的 `QIANWEN_API_KEY`
- **火山引擎TTS**：编辑 `video_synthesis/core/tts_huoshan.py` 中的 `access_token`

### 视频参数调整
编辑 `video_synthesis/config/settings.py` 可调整：
- 视频缩放比例
- 背景模糊程度
- 文字样式和位置
- 音频处理参数

## 📞 技术支持

### 常见问题
1. **FFmpeg未找到** - 确保FFmpeg已安装或使用项目自带版本
2. **API调用失败** - 检查网络连接和API密钥
3. **内存不足** - 减少同时处理的视频数量
4. **字体缺失** - 确保字体文件存在于fonts目录

### 获取帮助
- 查看详细安装指南：`INSTALL.md`
- 检查日志文件：`logs/` 目录
- 参考代码注释和文档

## �📄 许可证

MIT License

---

**🚀 开始使用：**
1. `pip install -r requirements.txt` - 安装依赖
2. 准备视频素材到 `assets/` 目录
3. `python app.py` - 开始批量处理
4. 查看 `outputs/` 目录获取结果

**享受AI驱动的视频创作体验！** 🎬✨